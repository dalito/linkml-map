<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://linkml.github.io/linkml-map/examples/MetamodelMapping/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Metamodel Mapping - LinkML-Map</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
    <link href="../../css/ansi-colours.css" rel="stylesheet">
    <link href="../../css/jupyter-cells.css" rel="stylesheet">
    <link href="../../css/pandas-dataframe.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "LinkML Metamodel Mappings", url: "#_top", children: [
              {title: "Creation of ad-hoc metamodel", url: "#creation-of-ad-hoc-metamodel" },
              {title: "Example schema conforming to ad-hoc metamodel", url: "#example-schema-conforming-to-ad-hoc-metamodel" },
              {title: "Mapping to LinkML metamodel", url: "#mapping-to-linkml-metamodel" },
              {title: "Customizing the LinkML model", url: "#customizing-the-linkml-model" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../schema/datamodel/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../schema/datamodel/" class="btn btn-xs btn-link">
        Data Model
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Tutorial-SQLCompiler/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Tutorial-SQLCompiler/" class="btn btn-xs btn-link">
        Compilation to SQL
      </a>
    </div>
    
  </div>

    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="linkml-metamodel-mappings">LinkML Metamodel Mappings</h1>
<p>The primary use case of LinkML is to map <em>data</em> to <em>data</em>. However, because the LinkML metamodel is
expressed as a LinkML schema, it is possible to map to and from the metamodel itself.</p>
<p><strong>NOTE</strong> this workflow is not yet fully matured, and is subject to change.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="creation-of-ad-hoc-metamodel">Creation of ad-hoc metamodel</h2>
<p>Let's assume that we have data represented using models conforming to an ad-hoc metamodel with core constructs: <code>Schema</code>, <code>Table</code>, and <code>Column</code>. We can create a LinkML schema that represents this metamodel as follows:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">linkml_runtime.linkml_model</span> <span class="kn">import</span> <span class="n">SlotDefinition</span>
<span class="kn">from</span> <span class="nn">linkml.utils.schema_builder</span> <span class="kn">import</span> <span class="n">SchemaBuilder</span>

<span class="n">sb</span> <span class="o">=</span> <span class="n">SchemaBuilder</span><span class="p">()</span>
<span class="n">sb</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;Schema&quot;</span><span class="p">,</span> 
             <span class="n">tree_root</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">slots</span><span class="o">=</span><span class="p">[</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the schema&quot;</span><span class="p">),</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;tables&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">,</span> <span class="n">multivalued</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inlined_as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">],</span>
             <span class="n">use_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;Table&quot;</span><span class="p">,</span>
            <span class="n">slots</span><span class="o">=</span><span class="p">[</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the table&quot;</span><span class="p">),</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s2">&quot;Column&quot;</span><span class="p">,</span> <span class="n">multivalued</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inlined_as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">],</span>
             <span class="n">use_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;Column&quot;</span><span class="p">,</span>
            <span class="n">slots</span><span class="o">=</span><span class="p">[</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the column&quot;</span><span class="p">),</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;primary_key&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s2">&quot;boolean&quot;</span><span class="p">),</span>
                <span class="n">SlotDefinition</span><span class="p">(</span><span class="s2">&quot;datatype&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
            <span class="p">],</span>
             <span class="n">use_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="p">)</span>

<span class="n">my_metamodel</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sb</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>name: test-schema
id: http://example.org/test-schema
default_prefix: http://example.org/test-schema/
classes:
  Schema:
    attributes:
      id:
        description: The name of the schema
        required: true
      tables:
        multivalued: true
        range: Table
        inlined_as_list: true
    tree_root: true
  Table:
    attributes:
      id:
        description: The name of the table
        required: true
      columns:
        multivalued: true
        range: Column
        inlined_as_list: true
  Column:
    attributes:
      id:
        description: The name of the column
        required: true
      primary_key:
        range: boolean
      datatype:
        range: string
prefixes: {}
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="example-schema-conforming-to-ad-hoc-metamodel">Example schema conforming to ad-hoc metamodel</h2>
<p>Now we'll make an example schema that conforms to this metamodel; this will be a fairly boring schema with a single table <code>Person</code> with three columns: <code>id</code>, <code>name</code>, and <code>description</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">my_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;my_schema&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tables&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;Person&quot;</span><span class="p">,</span>
            <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;primary_key&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;datatype&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;datatype&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;datatype&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="mapping-to-linkml-metamodel">Mapping to LinkML metamodel</h2>
<p>Now we'll create mappings from the ad-hoc metamodel to the LinkML metamodel, where <strong>Table</strong> maps to a LinkML <strong>ClassDefinition</strong>, <strong>Column</strong> maps to a LinkML *<em>SlotDefinition</em>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">metamap</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;class_derivations&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;SchemaDefinition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;Schema&quot;</span><span class="p">,</span>
            <span class="s2">&quot;slot_derivations&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;expr&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;https://example.org/&#39; + id&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;tables&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dictionary_key&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;cast_collection_as&quot;</span><span class="p">:</span> <span class="s2">&quot;MultiValuedDict&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;ClassDefinition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;Table&quot;</span><span class="p">,</span>
            <span class="s2">&quot;slot_derivations&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;columns&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dictionary_key&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;cast_collection_as&quot;</span><span class="p">:</span> <span class="s2">&quot;MultiValuedDict&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;SlotDefinition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;Column&quot;</span><span class="p">,</span>
            <span class="s2">&quot;slot_derivations&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;identifier&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;primary_key&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;populated_from&quot;</span><span class="p">:</span> <span class="s2">&quot;datatype&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">linkml_map.session</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">session</span><span class="o">.</span><span class="n">set_source_schema</span><span class="p">(</span><span class="n">my_metamodel</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">set_object_transformer</span><span class="p">(</span><span class="n">metamap</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">session</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">my_schema</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>WARNING:linkml_map.transformer.object_transformer:Unexpected: my_schema for type Schema
WARNING:linkml_map.transformer.object_transformer:Unexpected: Person for type Schema
WARNING:linkml_map.transformer.object_transformer:Unexpected: id for type Schema
WARNING:linkml_map.transformer.object_transformer:Unexpected: True for type boolean
WARNING:linkml_map.transformer.object_transformer:Unexpected: integer for type string
WARNING:linkml_map.transformer.object_transformer:Unexpected: name for type Schema
WARNING:linkml_map.transformer.object_transformer:Unexpected: string for type string
WARNING:linkml_map.transformer.object_transformer:Unexpected: description for type Schema
WARNING:linkml_map.transformer.object_transformer:Unexpected: string for type string
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range SlotDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
WARNING:linkml_map.transformer.transformer:Unknown target range ClassDefinition
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'name': 'my_schema',
 'id': 'https://example.org/my_schema',
 'classes': {'Person': {'attributes': {'id': {'identifier': True,
     'range': 'integer'},
    'name': {'identifier': None, 'range': 'string'},
    'description': {'identifier': None, 'range': 'string'}}}}}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="customizing-the-linkml-model">Customizing the LinkML model</h2>
<p>A different scenario is where you might want to customize the existing LinkML metamodel, in particular, adding additional
constraints. For example:</p>
<ul>
<li>class and names MUST be alphanumeric with no spaces</li>
<li>every element MUST have a definition</li>
</ul>
<p><strong>TODO</strong></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code>
</code></pre></div>

</div>
</div>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../schema/datamodel/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../schema/datamodel/" class="btn btn-xs btn-link">
        Data Model
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Tutorial-SQLCompiler/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Tutorial-SQLCompiler/" class="btn btn-xs btn-link">
        Compilation to SQL
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/linkml/linkml-map/edit/master/docs/examples/MetamodelMapping.ipynb"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>